<!DOCTYPE html>
<html>

<head>
</head>

<body>

    <script>

        if (document.cookie == "") {
            //No Cookie has been set previously, so set it now

            var params = getParams(window.location.href); //get all GET paramaters from URL
            var validEmail = "";
            if ("email" in params) { // check if email is provided in GET
                if (validateEmail(params["email"])) { //validate if email is in correct format
                    console.log("Valid Email is provided");
                    validEmail = "email=" + params["email"] + ";";
                }
            }

            var c = new Date(), e = new Date();
            e.setTime(c.getTime() + (30 * 24 * 60 * 60 * 1000)); // set expir for 30 days
            var initialDate = "initial=" + c.toUTCString() + ";";
            var expires = "expires=" + e.toUTCString() + ";";
            var path = "";
            document.cookie = initialDate + validEmail + expires + path;
            console.log("Cookie set properly");
        } else {
            //Cookie has been set previously, so perform checks

        }

        function getParams(url) {
            try {
                var params = {};
                var parser = document.createElement('a');
                parser.href = url;
                var query = parser.search.substring(1);
                var vars = query.split('&');
                for (var i = 0; i < vars.length; i++) {
                    var pair = vars[i].split('=');
                    params[pair[0]] = decodeURIComponent(pair[1]);
                }
                return params;
            } catch{
                return {}
            }
        }

        function validateEmail(email) {
            if (/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(email)) {
                return true
            }
            return false
        }

        function getCookie(cname) {
            var name = cname + "=";
            var decodedCookie = decodeURIComponent(document.cookie);
            var ca = decodedCookie.split(';');
            for (var i = 0; i < ca.length; i++) {
                var c = ca[i];
                while (c.charAt(0) == ' ') {
                    c = c.substring(1);
                }
                if (c.indexOf(name) == 0) {
                    return c.substring(name.length, c.length);
                }
            }
            return "";
        }


    </script>
</body>

</html>
